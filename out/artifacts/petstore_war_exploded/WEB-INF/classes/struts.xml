<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE struts PUBLIC
        "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"
        "http://struts.apache.org/dtds/struts-2.3.dtd">

<struts>

    <constant name="struts.enable.DynamicMethodInvocation" value="false"/>
    <constant name="struts.devMode" value="true"/>

    <package name="user" namespace="/" extends="struts-default">
        <interceptors>
            <!--检查是否登录拦截器-->
            <interceptor name="userInterceptor" class="com.petstore.web.interceptor.UserInterceptor"/>
            <!--注册拦截器-->
            <interceptor name="signLog" class="com.petstore.web.interceptor.SignLogInterceptor"/>
            <!--登录拦截器-->
            <interceptor name="loginLog" class="com.petstore.web.interceptor.LoginLogInterceptor"/>
            <!--登出拦截器-->
            <interceptor name="SignOutLog" class="com.petstore.web.interceptor.SignOutLogInterceptor"/>

            <!--检查是否登录-->
            <interceptor-stack name="user">
                <interceptor-ref name="userInterceptor"/>
                <interceptor-ref name="defaultStack"/>
            </interceptor-stack>

        </interceptors>

        <!--注册界面-->
        <action name="signForm">
            <result>/WEB-INF/jsp/user/sign.jsp</result>
        </action>
        <!--注册-->
        <action name="sign" class="com.petstore.web.action.UserAction" method="sign">
            <result name="success">index.jsp</result>
            <result name="error">/WEB-INF/jsp/user/sign.jsp</result>
            <interceptor-ref name="defaultStack"/>
            <interceptor-ref name="signLog"/>
        </action>
        <!--登录界面-->
        <action name="loginForm">
            <result>/WEB-INF/jsp/user/login.jsp</result>
        </action>
        <!--登录-->
        <action name="login" class="com.petstore.web.action.UserAction" method="login">
            <result name="success">index.jsp</result>
            <result name="error">/WEB-INF/jsp/user/login.jsp</result>
            <interceptor-ref name="defaultStack"/>
            <interceptor-ref name="loginLog"/>
        </action>
        <!--用户信息界面-->
        <action name="userInfo">
            <result>/WEB-INF/jsp/user/user.jsp</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--更改用户信息-->
        <action name="updateUser" class="com.petstore.web.action.UserAction" method="updateUser">
            <result name="success">/WEB-INF/jsp/user/user.jsp</result>
            <result name="error">/WEB-INF/jsp/user/user.jsp</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--退出登录-->
        <action name="signOut" class="com.petstore.web.action.UserAction" method="signOut">
            <result name="success">index.jsp</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="SignOutLog"/>
        </action>
        <!--检查用户名-->
        <action name="checkUsername" class="com.petstore.web.action.UserAction" method="checkUsername">
        </action>

        <action name="log" class="com.petstore.web.action.UserAction" method="log">
            <result name="success">/WEB-INF/jsp/user/log.jsp</result>
            <interceptor-ref name="user"/>
        </action>
    </package>

    <package name="shoppingCar" extends="struts-default">

        <interceptors>
            <interceptor name="userInterceptor" class="com.petstore.web.interceptor.UserInterceptor"/>

            <!--检查是否登录-->
            <interceptor-stack name="user">
                <interceptor-ref name="userInterceptor"/>
                <interceptor-ref name="defaultStack"/>
            </interceptor-stack>

        </interceptors>

        <!--进入购物车-->
        <action name="shoppingCar" class="com.petstore.web.action.ShoppingCarAction" method="shoppingCar">
            <result name="success">/WEB-INF/jsp/shoppingCar/shoppingCar.jsp</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--添加购物车-->
        <action name="addShoppingCar" class="com.petstore.web.action.ShoppingCarAction" method="addShoppingCar">
            <result name="success" type="redirectAction">shoppingCar</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--删除购物车某一项-->
        <action name="deleteShoppingCar" class="com.petstore.web.action.ShoppingCarAction" method="deleteShoppingCar">
            <result name="success" type="redirectAction">shoppingCar</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--更新购物车-->
        <action name="updateShoppingCar" class="com.petstore.web.action.ShoppingCarAction" method="updateShoppingCar">

        </action>
    </package>

    <package name="product" extends="struts-default">
        <!--类别-->
        <action name="category" class="com.petstore.web.action.ProductAction" method="category">
            <result name="success">/WEB-INF/jsp/product/categoryList.jsp</result>
        </action>
        <!--商品列表-->
        <action name="productList" class="com.petstore.web.action.ProductAction" method="productList">
            <result name="success">/WEB-INF/jsp/product/productList.jsp</result>
        </action>
        <!--商品信息-->
        <action name="product" class="com.petstore.web.action.ProductAction" method="product">
            <result name="success">/WEB-INF/jsp/product/product.jsp</result>
        </action>
        <!--搜索-->
        <action name="search" class="com.petstore.web.action.ProductAction" method="search">
            <result name="one">/WEB-INF/jsp/product/product.jsp</result>
            <result name="many">/WEB-INF/jsp/product/productList.jsp</result>
        </action>
        <!--自动补全，获取商品名称-->
        <action name="matchName" class="com.petstore.web.action.ProductAction" method="matchName">
        </action>
        <!--获取商品库存-->
        <action name="getStock" class="com.petstore.web.action.ProductAction" method="productStock">
        </action>
        <!--获取商品库存和单价-->
        <action name="getProductInfo" class="com.petstore.web.action.ProductAction" method="getStockAndPrice">
        </action>
    </package>

    <package name="bill" extends="struts-default">

        <interceptors>
            <interceptor name="userInterceptor" class="com.petstore.web.interceptor.UserInterceptor"/>

            <!--检查是否登录-->
            <interceptor-stack name="user">
                <interceptor-ref name="userInterceptor"/>
                <interceptor-ref name="defaultStack"/>
            </interceptor-stack>

        </interceptors>

        <!--打开生成账单页面-->
        <action name="updateNewBill" class="com.petstore.web.action.BillAction" method="updateNewBill">
            <result name="success">/WEB-INF/jsp/bill/buy.jsp</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--通过购物车购买-->
        <action name="addBillByCar" class="com.petstore.web.action.BillAction" method="addBillByCar">
            <result name="success" type="redirectAction">updateNewBill</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--通过商品页直接购物-->
        <action name="addBillByProduct" class="com.petstore.web.action.BillAction" method="addBillByProduct">
            <result name="success" type="redirectAction">updateNewBill</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--生成账单-->
        <action name="addBill" class="com.petstore.web.action.BillAction" method="bill">
            <result name="success">/WEB-INF/jsp/bill/okBuy.jsp</result>
            <result name="error">/WEB-INF/jsp/bill/buy.jsp</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--确认购买-->
        <action name="confirmBuy" class="com.petstore.web.action.BillAction" method="confirmBuy">
            <result name="success">/WEB-INF/jsp/bill/success.jsp</result>
            <result name="error">/WEB-INF/jsp/bill/okBuy.jsp</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--删除账单中的一项-->
        <action name="deleteItem" class="com.petstore.web.action.BillAction" method="deleteItem">
            <result name="success" type="redirectAction">updateNewBill</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--获取账单详细信息-->
        <action name="billDetail" class="com.petstore.web.action.BillAction" method="getBillDetail">
            <result name="success">/WEB-INF/jsp/bill/billDetail.jsp</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--获取账单列表-->
        <action name="billList" class="com.petstore.web.action.BillAction" method="getBillList">
            <result name="success">/WEB-INF/jsp/bill/billList.jsp</result>
            <result name="login" type="redirectAction">loginForm</result>
            <interceptor-ref name="user"/>
        </action>
        <!--更新账单-->
        <action name="updateItem" class="com.petstore.web.action.BillAction" method="updateItem">
        </action>
    </package>

</struts>
